const E=[{keys:["ghelp","help"],description:"Show available commands",run:r=>r.help()},{keys:["1","q","shoot"],description:"Shoot an arrow",run:r=>r.shoot()},{keys:["2","w","status"],description:"Show target status",run:r=>r.status()},{keys:["3","s","save"],description:"Generate save code",run:r=>r.save()},{keys:["4","l","load"],description:"Load game state",run:(r,t)=>t?r.load(t):["> LOAD FAILED: NO SAVE CODE PROVIDED"]},{keys:["5","ex","exit"],description:"Exit game",run:r=>r.exit()}],h={init:["> ARCHERY RANGE INITIALIZED","> TARGET: STRAW DUMMY"],unknown:['> TYPE "ghelp" FOR GAME COMMANDS'],help:[{text:"> =====================",group:"game",style:"warning"},{text:"> ARCHERY RANGE COMMANDS:",group:"game",style:"warning"},{text:"> =====================",group:"game",style:"warning"},{text:"> 1 | q - (shoot)				Fire an arrow",group:"game"},{text:"> 2 | w - (status)				Show target status",group:"game"},{text:"> 3 | s - (save)					Generate save code",group:"game"},{text:"> 4 | l - (load <code>)		Load save code",group:"game"},{text:"> 5 | ex - (exit)					Return to GAME MODE",group:"game"},{text:"> =====================",group:"game",style:"warning"}],exit:["> EXITING ARCHERY RANGE...","> SYSTEM: RETURN TO GAME MODE","> =====================",{text:'> TYPE "list" TO SEE AVAILABLE GAMES',group:"game",style:"separator"},{text:'> TYPE "ghelp" FOR GAME COMMANDS',group:"game",style:"separator"}],win(r){return[{text:"> =====================",group:"game"},{text:"> ===== YOU WIN! =====",group:"game"},{text:"> =====================",group:"game"},"> TARGET DESTROYED!",`> YOU FIRED ${r} SHOTS`,{text:"> =====================",group:"game"},{text:"> SYSTEM: EXITING GAME. RETURN TO GAME MODE",group:"game",style:"separator"},{text:'> TYPE "list" TO SEE AVAILABLE GAMES',group:"game",style:"separator"},{text:"> =====================",group:"game"}]},lose(r,t,e){return[{text:"> =====================",group:"error"},{text:"> ===== YOU LOSE! =====",group:"error"},{text:"> =====================",group:"error"},"> ARROWS DEPLETED!",`> YOU FIRED ${r} SHOTS TOTAL`,`> LEVEL REACHED: ${t}`,`> TOTAL DAMAGE DEALT: ${e}`,{text:"> =====================",group:"error"},{text:"> SYSTEM: EXITING GAME. RETURN TO GAME MODE",group:"game",style:"separator"},{text:'> TYPE "list" TO SEE AVAILABLE GAMES',group:"game",style:"separator"}]},levelUp(r,t,e){return[{text:"> =====================",group:"game"},{text:"> TARGET DESTROYED!",group:"game"},{text:"> =====================",group:"game"},`> YOU FIRED ${r} SHOTS TOTAL`,"> LEVEL UP!",`> NOW LEVEL ${e}`,`> ARROWS FOUND: +${t}`,"> NEW TARGET INITIALIZED"]}},a={INITIAL_LEVEL:1,MAX_HP:50,HIT_CHANCE:.6,CRIT_CHANCE:.25,DAMAGE_MIN:8,DAMAGE_MAX:18,INITIAL_ARROWS:10,ARROW_REWARD_MIN:6,ARROW_REWARD_MAX:14,DAMAGE_LEVEL_MULTIPLIER:.2};function i(r){const t=r.width??20;let e=0;function s(){const o=Math.round(e/r.max*t),p=t-o;return`[${"#".repeat(o)}${".".repeat(p)}] ${e}/${r.max}`}return{reset(){e=0},set(o){return e=Math.max(0,Math.min(o,r.max)),s()},increment(o=1){return e=Math.min(e+o,r.max),s()},get(){return e}}}class A{hp;maxHp;finished=!1;shots=0;level;arrows;totalDamage=0;hpBar=i({max:a.MAX_HP,width:10});constructor(){this.level=a.INITIAL_LEVEL,this.arrows=a.INITIAL_ARROWS,this.maxHp=this.getMaxHp(),this.hp=this.maxHp,this.hpBar=i({max:this.maxHp,width:10}),this.hpBar.set(this.hp)}getMaxHp(){return a.MAX_HP*this.level}resolveShot(){if(Math.random()>a.HIT_CHANCE)return{type:"miss"};let t=a.DAMAGE_MIN+Math.floor(Math.random()*(a.DAMAGE_MAX-a.DAMAGE_MIN));const e=Math.floor(t*(this.level-1)*a.DAMAGE_LEVEL_MULTIPLIER);let s=t+e;const o=Math.random()<a.CRIT_CHANCE;return o&&(s*=2),this.hp=Math.max(0,this.hp-s),this.totalDamage+=s,this.hp===0?{type:"destroyed",damage:s,crit:o,shots:this.shots}:{type:"hit",damage:s,crit:o}}handleCommand(t,e){const s=E.find(o=>o.keys.includes(t));return s?s.run(this,e):[{text:`GAME: UNKNOWN COMMAND "${t}"`,group:"error"},...h.unknown]}isFinished(){return this.finished}help(){return h.help}shoot(){if(this.hp<=0)return[{text:"> THE TARGET IS ALREADY DESTROYED",group:"error"}];if(this.arrows<=0)return this.finished=!0,h.lose(this.shots,this.level,this.totalDamage);this.arrows--,this.shots++;const t=this.resolveShot(),e=[];if(t.type==="miss"?e.push({text:"> SHOT MISSED",group:"game",style:"separator"}):(t.type==="hit"||t.type==="destroyed")&&e.push({text:t.crit?`> CRITICAL HIT! (-${t.damage})`:`> HIT (-${t.damage})`,group:"game",style:"result"}),t.type!=="destroyed")e.push({id:"archery-hp",group:"error",text:`> HP: ${this.hpBar.set(this.hp)}`}),this.arrows<=0&&this.hp>0&&(this.finished=!0,e.push(...h.lose(this.shots,this.level,this.totalDamage)));else{const s=Math.floor(Math.random()*(a.ARROW_REWARD_MAX-a.ARROW_REWARD_MIN+1))+a.ARROW_REWARD_MIN;this.level++,this.arrows+=s,this.maxHp=this.getMaxHp(),this.hp=this.maxHp,this.hpBar=i({max:this.maxHp,width:10}),this.hpBar.set(this.hp),e.push(...h.levelUp(this.shots,s,this.level)),e.push({id:"archery-hp",group:"error",text:`> HP: ${this.hpBar.set(this.hp)}`})}return e}status(){return["> STATUS","> =====================","> TARGET: STRAW DUMMY","> =====================",{text:`> LEVEL: ${this.level}`,group:"game",style:"result"},{text:`> ARROWS: ${this.arrows}`,group:"game",style:"result"},{text:`> HP: ${this.hpBar.set(this.hp)}`,group:"error"},{text:`> SHOTS FIRED: ${this.shots}`,group:"game",style:"result"},{text:`> TOTAL DAMAGE: ${this.totalDamage}`,group:"game",style:"result"},"> ====================="]}save(){const t={hp:this.hp,shots:this.shots,level:this.level,arrows:this.arrows,totalDamage:this.totalDamage};return["> SAVE CODE:",btoa(JSON.stringify(t)),{text:"> USE: load <code>",group:"game",style:"separator"}]}load(t){if(!t)return[{text:"> INVALID SAVE CODE",group:"error"}];try{const e=atob(t.trim()),s=JSON.parse(e);if(typeof s.hp!="number")throw new Error("Invalid structure");return this.hp=s.hp,this.shots=s.shots??0,this.level=s.level??a.INITIAL_LEVEL,this.arrows=s.arrows??a.INITIAL_ARROWS,this.totalDamage=s.totalDamage??0,this.maxHp=this.getMaxHp(),this.hpBar=i({max:this.maxHp,width:10}),this.hpBar.set(this.hp),[{text:"> SAVE LOADED",group:"game"},{text:`> HP: ${this.hpBar.set(this.hp)}`,group:"error"}]}catch{return[{text:"> INVALID SAVE CODE",group:"error"}]}}exit(){return this.finished=!0,h.exit}}const u={id:"archery",command:"1",title:"Archery Range",description:"Shoot targets and level up!",order:1,create(){return new A},intro(){return[{text:"> ARCHERY RANGE STARTED",group:"game",style:"title"},{text:"> "+this.description,group:"game",style:"description"},{text:'> TYPE "ghelp" FOR AVAILABLE COMMANDS',group:"system"}]}};export{u as default};
